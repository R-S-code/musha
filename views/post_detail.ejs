<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= post[0].title %></title>
  <link rel="stylesheet" type="text/css" href="/css/set/normalize.css" />
  <link rel="stylesheet" type="text/css" href="/css/set/default.css" />
  <link rel="stylesheet" type="text/css" href="/css/article_detail.css" />
</head>
<body>
<%- include("./set/header"); %>

<main class="article-detail-whole-wrapper">
  <div class="article-detail-whole-container">
    <div class="article-detail-top-wrapper">
      <div class="article-detail-head-wrapper">
        <div class="article-detail-contributor-icon"><img src="/usericon/<%= post[0].contributor_id %>.jpg"  onerror="this.src='/userIcon/default.png';"/ alt="no pic"></div>
        <p class="article-detail-head-username"><%= post[0].username %></p>
        <div class="article-detail-head-like" id="like">♡</div>
        <p>100</p>
      </div>
      <h1 class="article-detail-title"><%= post[0].title %></h1>
      <!-- ストックボタン -->
      <div class="article-detaile-stock-btn-wrapper">
        <button class="article-detaile-stock-btn" id="stock_btn">ストックする</button>
      </div>
    </div>
    <div class="article-detail-contents-wrapper">
      <div class="article-detail-contents-container">
        <p style="font-weight: 700;font-size: 20px"><%= post[0].article %></p>
      </div>
    </div>
    
    <div class="article-detail-comments-wrapper">
      <div class="article-detail-comments-title-wrapper">
        <div class="article-detail-comments-ico"><img src="/images/ico_comment.png"></div>
        <h1 class="article-detail-comments-title">コメント</h1>
      </div>
      <% post_comments.forEach((info) => { %>
        <div class="article-detail-comments-head">
          <div><img src="/usericon/<%= info.contributor_id %>.jpg"  onerror="this.src='/userIcon/default.png';"/ alt="no pic"></div>
          <p><%= info.username %></p>
        </div>
        <p class="article-detail-comments-comment"><%= info.comment %></p>
        <hr>
      <% }) %>
    </div>

    <div class="article-detail-post-wrapper">
      <h1 class="article-detail-comments-post-title">投稿</h1>
      <form action="/postComment/<%= post[0].post_id %>" method="POST">
        <textarea name="comment" name="comment" class="article-detail-input-commment"></textarea>
        <button type="submit" class="article-detail-postcomment-btn">投稿する</button>
      </form>
    </div>
  </div>
</main>
<p id="postid"><%= post[0].article_id %></p>
<%- include("./set/footer"); %>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  const stock_btn = document.getElementById("stock_btn");
  const like = document.getElementById("like");
  const post_id = document.getElementById("postid").innerText;

  // 画面読み込み時ストックチェック
  window.onload = ()=> {
    axios({
      method : 'GET',
      url : 'http://localhost:3800/stock_axios_check',
      params : { id : post_id }
    })
    .then((response)=> {
      if(response["data"]["result"]["length"] ==! 0) {
        stock_btn.innerText = ("ストックから外す");
      }
    })
  }

  // ストック、アンストック
  stock_btn.addEventListener("click", ()=>{
    if(stock_btn.innerText == "ストックから外す") {
      axios({
        method : 'GET',
        url : 'http://localhost:3800/unstock_axios',
        params : { id : post_id }
      })
      .then((response)=> {
        console.log(response);
        stock_btn.innerText = ("ストックする");
      })
    } else {
      axios({
        method : 'GET',
        url : 'http://localhost:3800/stock_axios',
        params : { id : post_id }
      })
      .then((response)=> {
        console.log(response);
        stock_btn.innerText = ("ストックから外す");
      })
    }
  })

</script>
</body>
</html>